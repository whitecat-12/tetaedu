<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  <title>Planet Bumi - Optimized</title>
  <style>
    :root { --ui-height: 78px; }
    html,body { height:100%; margin:0; }
    body { display:flex; flex-direction:column; background:#333; font-family: sans-serif; color:#222; }
    #scene-container { flex:1; position:relative; background: #fff; overflow:hidden; }
    canvas { display:block; width:100%; height:100%; }
    #controls {
      position:absolute;
      top:10px; left:10px;
      background:rgba(255,255,255,0.95);
      padding:8px;
      border-radius:8px;
      z-index:20;
    }
    #bottom-panel {
      height:60px;
      display:flex;
      align-items:center;
      justify-content:center;
      position:relative;
      z-index:30;
      background:transparent;
      padding-bottom:8px;
      pointer-events:none;
    }
    #infoDrawer {
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:-320px;
      width:min(460px,92%);
      max-height:300px;
      background:rgba(255,255,255,0.98);
      border-radius:12px 12px 0 0;
      box-shadow:0 -6px 30px rgba(0,0,0,0.35);
      padding:16px;
      transition:bottom 250ms ease;
      z-index:40;
      overflow:auto;
      pointer-events:auto;
      touch-action: none; /* penting supaya drag lancar di mobile */
    }
    #infoDrawer.show { bottom:78px; }
    #infoDrawer .handle {
      width:40px;
      height:5px;
      background:#aaa;
      border-radius:3px;
      margin:0 auto 10px auto;
      cursor:grab;
    }
    #infoDrawer h4 { margin:0 0 8px; font-size:18px; }
    #infoDrawer p { margin:6px 0; font-size:14px; line-height:1.4; color:#333; }
  </style>
</head>
<body>
  <div id="scene-container">
    <div id="controls">
      <label>Kecepatan Rotasi:
        <input id="speed" type="range" min="0" max="0.05" step="0.001" value="0.005">
      </label>
    </div>
    <div id="infoDrawer">
      <div class="handle"></div>
      <h4>Planet Bumi</h4>
      <p>Bumi adalah planet ketiga dari Matahari dan satu-satunya planet yang diketahui memiliki kehidupan.</p>
      <p><strong>Diameter:</strong> ~12.742 km<br><strong>Rotasi:</strong> 24 jam<br><strong>Revolusi:</strong> 365 hari</p>
    </div>
  </div>
  <div id="bottom-panel"></div>

  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script>
    const container = document.getElementById('scene-container');
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xffffff);

    const camera = new THREE.PerspectiveCamera(45, 1, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setPixelRatio(window.innerWidth < 800 ? 1 : Math.min(window.devicePixelRatio, 2));
    container.appendChild(renderer.domElement);

    scene.add(new THREE.AmbientLight(0xffffff, 0.35));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5,3,5);
    scene.add(dirLight);

    let rotationSpeed = parseFloat(document.getElementById('speed').value);
    document.getElementById('speed').addEventListener('input', e => rotationSpeed = parseFloat(e.target.value));

    const loader = new THREE.TextureLoader();
    let earth, clouds;

    Promise.all([
      loader.loadAsync('earthmap1k.jpg'),
      loader.loadAsync('earthbump.jpg'),
      loader.loadAsync('specularmap.jpg'),
      loader.loadAsync('earthCloud.png')
    ]).then(([map, bump, spec, cloud]) => {
      const mat = new THREE.MeshPhongMaterial({
        map, bumpMap: bump, bumpScale: 0.05,
        specularMap: spec, specular: new THREE.Color('grey')
      });
      earth = new THREE.Mesh(new THREE.SphereGeometry(1, 32, 32), mat);
      scene.add(earth);

      const cloudMat = new THREE.MeshPhongMaterial({ map: cloud, transparent: true, depthWrite:false });
      clouds = new THREE.Mesh(new THREE.SphereGeometry(1.01, 32, 32), cloudMat);
      scene.add(clouds);

      fitCamera(1);
      animate();
    });

    function fitCamera(radius=1, margin=1.12) {
      const w = container.clientWidth;
      const h = container.clientHeight;
      camera.aspect = w/h;
      camera.updateProjectionMatrix();
      const vFov = camera.fov * Math.PI / 180;
      const dH = radius / Math.tan(vFov / 2);
      const required = Math.max(dH, dH / Math.min(camera.aspect, 1));
      camera.position.set(0,0,required * margin);
      camera.lookAt(0,0,0);
      renderer.setSize(w, h);
    }

    window.addEventListener('resize', () => fitCamera(1, 1.12));

    let animating = true;
    document.addEventListener('visibilitychange', () => {
      animating = !document.hidden;
    });

    function animate() {
      renderer.setAnimationLoop(() => {
        if (animating) {
          if (earth) earth.rotation.y += rotationSpeed;
          if (clouds) clouds.rotation.y += rotationSpeed * 1.2;
        }
        renderer.render(scene, camera);
      });
    }

    // Drawer Drag
    const infoDrawer = document.getElementById('infoDrawer');
    const handle = infoDrawer.querySelector('.handle');
    let startY = 0;
    let startBottom = 0;
    let isDragging = false;

    handle.addEventListener('mousedown', startDrag);
    handle.addEventListener('touchstart', startDrag);

    function startDrag(e) {
      isDragging = true;
      startY = e.touches ? e.touches[0].clientY : e.clientY;
      startBottom = parseInt(getComputedStyle(infoDrawer).bottom);
      document.addEventListener('mousemove', onDrag);
      document.addEventListener('touchmove', onDrag, { passive: false });
      document.addEventListener('mouseup', endDrag);
      document.addEventListener('touchend', endDrag);
    }

    function onDrag(e) {
      if (!isDragging) return;
      e.preventDefault();
      const y = e.touches ? e.touches[0].clientY : e.clientY;
      const delta = startY - y;
      let newBottom = Math.min(78, Math.max(-320, startBottom + delta));
      infoDrawer.style.bottom = newBottom + 'px';
    }

    function endDrag() {
      isDragging = false;
      const currentBottom = parseInt(getComputedStyle(infoDrawer).bottom);
      if (currentBottom > -160) {
        infoDrawer.classList.add('show');
        infoDrawer.style.bottom = '78px';
      } else {
        infoDrawer.classList.remove('show');
        infoDrawer.style.bottom = '-320px';
      }
      document.removeEventListener('mousemove', onDrag);
      document.removeEventListener('touchmove', onDrag);
      document.removeEventListener('mouseup', endDrag);
      document.removeEventListener('touchend', endDrag);
    }
  </script>
</body>
</html>
